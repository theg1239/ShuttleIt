<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="css/homestyle.css">
</head>
<body>
    <div class="logo">
        <img src="shuttleitlogo.png" alt="ShuttleIT Logo">
    </div>

    <div id="menu">
        <button onclick="location.href='student-dashboard.html';">Track Shuttles</button>
        <div id="eta">
            <p>ETA: <span id="eta-time">Calculating...</span></p>
            <div id="other-drivers-etas"></div>
        </div>
        <div id="shuttles-active">
	  <strong>Shuttles active: </strong><span id="shuttles-online">Calculating...</span>
	</div>
    </div>

    <div class="dark-mode-toggle">
        <input type="checkbox" id="darkModeCheckbox" class="checkbox">
        <label for="darkModeCheckbox" class="label">
            <span class="ball"></span>
        </label>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCe23F3CFtz-lbBFxXdjfv-z5oE9PhlyzE",
            authDomain: "shuttle-web-538fa.firebaseapp.com",
            databaseURL: "https://shuttle-web-538fa-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "shuttle-web-538fa",
            storageBucket: "shuttle-web-538fa.appspot.com",
            messagingSenderId: "189496484474",
            appId: "1:189496484474:web:d8929149d890cf573ad1c3",
            measurementId: "G-M20NXLPBD3"
        };

        firebase.initializeApp(firebaseConfig);

        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                console.log('User is signed in:', user);
            } else {
                // No user is signed in, redirect to login page
                location.href = 'index.html';
            }
        });
    </script>
    <script src="eta.js"></script>
    <script>
        var darkModeCheckbox = document.getElementById('darkModeCheckbox');

        var darkModePreference = localStorage.getItem('darkMode') === 'true';
        document.body.classList.toggle('dark-mode', darkModePreference);
        darkModeCheckbox.checked = darkModePreference;

        darkModeCheckbox.addEventListener('change', function(event) {

            document.body.classList.toggle('dark-mode', event.target.checked);

            localStorage.setItem('darkMode', event.target.checked);
        });
    </script>
<script>
  function updateShuttleCount() {
    const driversRef = firebase.database().ref('driverLocations');
    driversRef.on('value', snapshot => {
        const drivers = snapshot.val();
        const activeThreshold = 5 * 60 * 1000; 
        const now = Date.now();

        let activeDrivers = 0;
        if (drivers) {
            Object.keys(drivers).forEach(driverId => {
                const driver = drivers[driverId];

                if (driver.timestamp && (now - driver.timestamp) < activeThreshold) {
                    activeDrivers++;
                }
            });
        }

        document.getElementById('shuttles-online').textContent = `${activeDrivers} active`;
    });
}

document.addEventListener('DOMContentLoaded', updateShuttleCount);
</script>
</body>
</html>
